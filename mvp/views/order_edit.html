<?php

$is_edit = $controller->getModel()->__get('is_edit');

$key = $controller->getModel()->__get('record')['key_order'];
$date = $controller->getModel()->__get('record')['date'];
$key_client = $controller->getModel()->__get('record')['key_client'];
$clients = $controller->getModel()->__get('clients');

$detail_sum = $controller->getModel()->__get('detail_sum');
$details = $controller->getModel()->__get('details');

$all_details = array(
	array('name_detail'=>'A', 'price'=>100), 
	array('name_detail'=>'B', 'price'=>120),
	array('name_detail'=>'C', 'price'=>150)
);

$error = $controller->getModel()->__get('error');

echo "<br />";
if(!$is_edit) echo "<h3>Добавить заказ</h3>";
else echo "<h3>Редактировать заказ</h3>";
echo '
		<form method="POST" action="/order/save/">
			<table td="tab">
				<tr>
					<td class="tab_name">Номер заказа</td>
					<td>'.$key.'</td>
				</tr>
				
				<tr>
					<td  class="tab_name">Дата (\'гггг-мм-дд\')</td>
					<td><input type="text" name="date" value="'.$date.'" /></td>
				</tr>
				
				<tr>
					<td  class="tab_name">Клиент</td>
					<td>
						<select name="key_client[]" size="2">';
foreach($clients as $client)
{
	echo '
							<option value="'.$client['key_client'].'"';
	if($client['key_client'] == $key_client) echo ' selected="selected"';
	echo '
							>'.$client['full_name'].'</option>';
}
echo '
						</select>
					</td>
				</tr>';
				
if(!empty($error)) echo '
				<tr>
					<td colspan="2" class="error">Не заполнено обязательное поле "'.$error.'"!</td>
				</tr>';
echo '
				<tr>
					<td colspan="2" align="center" style="padding-top:20px;">
						<input type="submit" name="submit" value="';
if(!$is_edit) echo "Добавить";
else echo "Сохранить";
echo '" />';
if($is_edit) echo '<input type="hidden" name="key" value="'.$key.'" />';
echo '
					</td>
				</tr>
			</table>
		</form>
		
		<div id="details">
			<hr />
			<h3>Детали в заказе: '.$key.'</h3>
			<table id="details_list">
				<tr>
					<th>X</th>
					<th>Деталь</th>
					<th>Цена, руб.</th>
				</tr>';
foreach($details as $detail)
{
	echo '
				<tr>
					<td><a href="">X</a></td>
					<td>'.$detail['name_detail'].'</td>
					<td>'.$detail['price'].'</td>
				</tr>';
}
echo '
				<tr>
					<td colspan="2">Итого:</td>
					<td>'.$detail_sum.'</td>
				</tr>
			</table>
			<form method="GET" action="/order/edit/?key='.$key.'">
				<table>
					<tr>
						<td>Добавить деталь:</td>
						<td>
							<select name="detail[]" onchange="this.form.submit()">';
foreach($all_details as $detail)
{
	echo '
								<option value="11">'.$detail['name_detail'].'</option>';
}
	
echo '
							</select>
						</td>
					</tr>
				</table>
				<input type="hidden" name="key" value="'.$key.'" />
			</form>
		</div>
		
		<div id="services">
			<hr />
			<h3>Список работ:</h3>
			<table id="services_list">
			</table>
		</div>';
